<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/controller_cierre.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/controller_cierre.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { tbl_Cierre } from "../models/tbl_Cierre.js";

/**
 * Crea un nuevo cierre de jornada.
 *
 * Este endpoint recibe los detalles de un cierre de jornada, valida los campos requeridos
 * y crea un nuevo registro en la base de datos con la información proporcionada.
 *
 * @async
 * @function crearCierre
 * @param {Object} req - Objeto de solicitud (Request) de Express.
 * @param {Object} req.body - El cuerpo de la solicitud que contiene los detalles del cierre.
 * @param {number} req.body.cantidadPlatos - La cantidad total de platos servidos en la jornada.
 * @param {number} req.body.valorTotal - El valor total recaudado en la jornada.
 * @param {string} req.body.fecha - La fecha del cierre en formato `YYYY-MM-DD`.
 * @param {number} req.body.cantidadEventos - La cantidad total de eventos realizados en la jornada.
 * @param {Object} res - Objeto de respuesta (Response) de Express.
 * @returns {JSON} Devuelve un objeto JSON que indica el éxito o el error de la operación.
 */
export const crearCierre = async (req, res) => {
  const { cantidadPlatos, valorTotal, fecha, cantidadEventos } = req.body;

  // Validar los datos requeridos
  if (!cantidadPlatos || !valorTotal || !fecha || !cantidadEventos) {
    return res.status(400).json({
      status: "error",
      message: "Todos los campos son obligatorios.",
    });
  }

  try {
    const nuevoCierre = await tbl_Cierre.create({
      cantidadPlatos,
      valorTotal,
      fecha,
      cantidadEventos,
    });

    res.status(201).json({
      status: "success",
      message: "Cierre realizado con éxito.",
      data: nuevoCierre,
    });
  } catch (error) {
    res.status(500).json({
      status: "error",
      message: "Error al realizar el cierre.",
      error: error.message,
    });
  }
};

/**
 * Editar un cierre existente.
 *
 * Este endpoint permite editar los detalles de un cierre existente en la base de datos.
 * Los campos obligatorios deben ser proporcionados en la solicitud.
 *
 * @async
 * @function editarCierre
 * @param {Object} req - Objeto de solicitud (Request) de Express.
 * @param {Object} req.params - Parámetros de la ruta.
 * @param {number} req.params.id - El ID del cierre a editar.
 * @param {Object} req.body - El cuerpo de la solicitud que contiene los nuevos detalles del cierre.
 * @param {number} req.body.cantidadPlatos - La nueva cantidad total de platos servidos.
 * @param {number} req.body.valorTotal - El nuevo valor total recaudado.
 * @param {string} req.body.fecha - La nueva fecha del cierre en formato `YYYY-MM-DD`.
 * @param {number} req.body.cantidadEventos - La nueva cantidad total de eventos realizados.
 * @param {Object} res - Objeto de respuesta (Response) de Express.
 * @returns {JSON} Devuelve un objeto JSON que indica el éxito o el error de la operación.
 */
export const editarCierre = async (req, res) => {
  const { id } = req.params;
  const { cantidadPlatos, valorTotal, fecha, cantidadEventos } = req.body;

  // Validar los datos requeridos
  if (!id || !cantidadPlatos || !valorTotal || !fecha || !cantidadEventos) {
    return res.status(400).json({
      status: "error",
      message: "Todos los campos son obligatorios",
    });
  }

  try {
    const cierreExistente = await tbl_Cierre.findByPk(id);

    if (!cierreExistente) {
      return res.status(404).json({
        status: "error",
        message: "Cierre no encontrado.",
      });
    }

    await tbl_Cierre.update(
      {
        cantidadPlatos,
        valorTotal,
        fecha,
        cantidadEventos,
      },
      { where: { id } }
    );

    res.status(200).json({
      status: "success",
      message: "Cierre actualizado con éxito.",
    });
  } catch (error) {
    res.status(500).json({
      status: "error",
      message: "Error al actualizar el cierre.",
      error: error.message,
    });
  }
};

/**
 * Traer todos los cierres.
 *
 * Este endpoint permite obtener todos los registros de cierres de la base de datos.
 *
 * @async
 * @function traerTodosCierre
 * @param {Object} req - Objeto de solicitud (Request) de Express.
 * @param {Object} res - Objeto de respuesta (Response) de Express.
 * @returns {JSON} Devuelve un objeto JSON que contiene todos los cierres o un mensaje de error si no hay cierres.
 */
export const traerTodosCierre = async (req, res) => {
  try {
    const traerTodos = await tbl_Cierre.findAll();
    if (traerTodos.length > 0) {
      res.status(200).json({
        status: "succes",
        message: traerTodos,
      });
    } else {
      res.status(400).json({
        status: "error",
        message: "No hay cierres registrados",
      });
    }
  } catch (error) {
    res.status(500).json({
      status: "error",
      message: "Error al traer todos los campos",
      error: error.message,
    });
  }
};

/**
 * Traer cierre por ID.
 *
 * Este endpoint permite obtener un cierre específico de la base de datos utilizando su ID.
 *
 * @async
 * @function traerCierreID
 * @param {Object} req - Objeto de solicitud (Request) de Express. Debe incluir el ID del cierre en `req.params`.
 * @param {Object} res - Objeto de respuesta (Response) de Express.
 * @returns {JSON} Devuelve un objeto JSON que contiene los datos del cierre o un mensaje de error si no se encuentra.
 */
export const traerCierreID = async (req, res) => {
  const { id } = req.params;
  if (!id) {
    return res.status(400).json({
      status: "error",
      message: "Debes ingresar el id del cierre",
    });
  }

  try {
    const cierreExistente = await tbl_Cierre.findByPk(id);
    if (!cierreExistente) {
      res.status(400).json({
        status: "eror",
        message: "No se encontro el cierre",
      });
    } else {
      res.status(200).json({
        status: "success",
        message: cierreExistente,
      });
    }
  } catch (error) {
    res.status(500).json({
      status: "error",
      message: "Error al realizar la consulta",
      error: error.message,
    });
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#CambiarEstadoUsuario">CambiarEstadoUsuario</a></li><li><a href="global.html#EditarUsuario">EditarUsuario</a></li><li><a href="global.html#TraerTodosUsuarios">TraerTodosUsuarios</a></li><li><a href="global.html#TraerUsuarioId">TraerUsuarioId</a></li><li><a href="global.html#almacenamiento">almacenamiento</a></li><li><a href="global.html#cambiarEstadoEvento">cambiarEstadoEvento</a></li><li><a href="global.html#crearCierre">crearCierre</a></li><li><a href="global.html#crearEvento">crearEvento</a></li><li><a href="global.html#crearUsuario">crearUsuario</a></li><li><a href="global.html#editarCierre">editarCierre</a></li><li><a href="global.html#editarEvento">editarEvento</a></li><li><a href="global.html#func_EditarMenu">func_EditarMenu</a></li><li><a href="global.html#func_EditarPedido">func_EditarPedido</a></li><li><a href="global.html#func_EliminarMenu">func_EliminarMenu</a></li><li><a href="global.html#func_InsertarMenu">func_InsertarMenu</a></li><li><a href="global.html#func_InsertarPedido">func_InsertarPedido</a></li><li><a href="global.html#func_iniciarSesion">func_iniciarSesion</a></li><li><a href="global.html#func_registrarUsuario">func_registrarUsuario</a></li><li><a href="global.html#func_selecionarTodosLosMenus">func_selecionarTodosLosMenus</a></li><li><a href="global.html#traerCierreID">traerCierreID</a></li><li><a href="global.html#traerEventoId">traerEventoId</a></li><li><a href="global.html#traerTodosCierre">traerTodosCierre</a></li><li><a href="global.html#traerTodosEventos">traerTodosEventos</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Wed Aug 14 2024 06:17:26 GMT-0500 (hora estándar de Colombia)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
